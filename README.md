# FishUsage

### Data and code to reproduce the analyses from  
**“Targeting morphologically unique fishes amplifies the risk of functional erosion”**  
*Pierre Bouchet, Sébastien Brosse & Aurèle Toussaint*  
CNRS, Université de Toulouse

---

## Overview

This repository contains all data and R scripts necessary to reproduce the analyses presented in the manuscript *Targeting morphologically unique fishes amplifies the risk of functional erosion* (manuscript under review).

The project evaluates whether human uses of freshwater fishes—including food, ornamental trade, and recreational activities—are concentrated on narrow portions of the global fish functional spectrum. We test the expectation that humans select a non-random subset of species, and that morphologically unique species, often already threatened, are disproportionately targeted, increasing risks of functional erosion.

The repository covers all freshwater fish species globally, integrating phylogeny, functional morphology, human use information, and conservation status (IUCN assessments).

---

## Repository Structure

### Data folders

**`dataOriginal/`**  
Contains the raw input datasets used in the project:
- Raw functional trait data from **FishMorph**
- Global freshwater fish phylogeny from **Rabosky et al. (2018)**
- IUCN Red List assessments
- `species_to_update_900_done`: manual taxonomic updates and corrections based on IUCN assessments  

These files correspond to the original, unmodified datasets.

**`dataPrepared/Fish/`**  
Contains all processed and prepared datasets used for the analyses.  
Users may work directly with these files or regenerate them using the data-loading scripts.  
This folder includes the cleaned, formatted, and harmonized datasets required for the analysis pipeline.

---

### Outputs and figures

**`figures/`**  
Folder intended for storing figures created by the analysis scripts.  
It is initially empty except for the cleaned manuscript figures, allowing users to export their own figures into this directory.

**`output/`**  
Contains all outputs generated by the scripts, including intermediate objects, result tables, and `.rds` files used in downstream analyses.

---

### Code

**`script/`**  
Contains all R scripts used in the project (10 scripts total), including:
- `000_library.R` — package loading
- `000_functions.R` — custom functions used throughout the analysis
- `000_LoadData.R` — data import, cleaning, and preparation
- `000_ScrappingData.R` — optional script to reproduce the scraping workflow
- `0XX_analysis_*.R` — sequential analysis scripts
- `0XX_fig_*.R` — scripts generating manuscript and supplementary figures  

Scripts are numbered to ensure full reproducibility when run in order.

---

## Scripts overview

Scripts follow a numbered sequential pipeline:

- **000_library.R** — loads all required R packages  
- **000_functions.R** — functions used across analyses  
- **000_LoadData.R** — imports, cleans, and prepares all datasets  
- **000_ScrappingData.R** — optional scraping workflow (not required to rerun)  
- **0XX_analysis_*.R** — analysis scripts  
- **0XX_figures_*.R** — figure-generation scripts  

Some analyses are computationally intensive.  
Long HPC-dependent steps are commented out, and corresponding processed `.rds` files are provided to allow full reproduction of results without rerunning heavy computations.

---

## Reproducibility workflow (simple)

1. Clone the repository  
2. Open R (≥ 4.3.2)  
3. Run `000_library.R`  
4. Run `000_functions.R`  
5. Run `000_LoadData.R`  
6. Run the numbered analysis scripts in order  
7. Run the figure scripts to reproduce all manuscript and supplementary figures  

---

## Expected outputs

Running the full pipeline reproduces:
- All main figures included in the manuscript  
- All supplementary figures  
- Intermediate and final result tables used in the analyses  

---

## System requirements

- **R version:** 4.3.2 or later  
- **Operating systems tested:** Windows and MacOS  
- **Dependencies:** All required R packages are listed and loaded in `000_library.R`  
- **Non-standard hardware:** None required  

Typical installation time on a standard desktop computer is a few minutes.  
Typical runtime ranges from minutes to several hours depending on whether computationally intensive steps are re-run.

---

## License

This code is released under the **MIT License**.
